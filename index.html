<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spinta â†’ Deriniai (PrincipÅ³ versija)</title>
  <meta name="theme-color" content="#0b0b10">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png">
  <style>
    :root{ --bg:#0b0b10; --card:#14141d; --muted:#7a7a8c; --text:#eaeaf2; --line:#222230; }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#0b0b10,#12121a 60%,#0b0b10); color:var(--text)}
    header{position:sticky; top:0; backdrop-filter:saturate(160%) blur(8px); background:rgba(10,10,16,.6); border-bottom:1px solid var(--line); z-index:10}
    header .wrap{display:flex; gap:16px; align-items:center; padding:14px 18px; max-width:1150px; margin:0 auto}
    .brand{font-weight:700; letter-spacing:.3px}
    .pill{border:1px solid var(--line); padding:6px 10px; border-radius:999px; color:var(--muted); font-size:12px}
    main{max-width:1150px; margin:24px auto; padding:0 18px;}
    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:#14141d; border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 8px 26px rgba(0,0,0,.25)}
    h2{margin:0 0 12px 0; font-size:18px}
    label{font-size:12px; color:var(--muted)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row > *{flex:1}
    input[type="file"]{padding:10px; background:#0f0f16; border:1px dashed #2a2a3a; border-radius:12px; color:var(--muted)}
    select, input[type="text"], input[type="number"], button, input[type="range"]{background:#0f0f16; border:1px solid #26263a; color:var(--text); padding:10px 12px; border-radius:12px}
    button{cursor:pointer; font-weight:600}
    button.primary{background:linear-gradient(135deg,#ff2a6d,#ff6a3d); border:none}
    button.ghost{background:transparent; border:1px solid #33334a}
    .wardrobe{display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px}
    .item{background:#0f0f16; border:1px solid #2a2a3a; border-radius:14px; overflow:hidden}
    .item .imgwrap{aspect-ratio:1/1; background:#0a0a12; display:grid; place-items:center}
    .item img{max-width:100%; max-height:100%; display:block; object-fit:contain}
    .item .meta{padding:10px; display:flex; align-items:center; justify-content:space-between; gap:8px}
    .chip{font-size:11px; color:#cfcfe6; padding:4px 8px; border-radius:999px; border:1px solid #3a3a55}
    .swatches{display:flex; gap:6px; align-items:center}
    .sw{width:14px; height:14px; border-radius:4px; border:1px solid #0006}
    .tags{display:flex; gap:6px; flex-wrap:wrap; padding:0 10px 10px}
    .tag{font-size:10px; color:#aeb0d3; border:1px dashed #343454; padding:3px 6px; border-radius:999px}
    .outfits{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:14px}
    .outfit{background:#0f0f16; border:1px solid #2a2a3a; border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:10px}
    .canvaswrap{background:conic-gradient(from 180deg at 50% 20%, #111018, #0b0b12 40%, #121224); border:1px solid #22223a; border-radius:12px; display:grid; place-items:center; aspect-ratio:3/4; position:relative; overflow:hidden}
    .canvaswrap canvas{ width:100%; height:100%; display:block; }
    .loading{position:absolute; inset:auto 12px 12px auto; background:#1b1b28; border:1px solid #2a2a3a; border-radius:10px; padding:6px 10px; font-size:12px; color:#cfd0e6}
    .muted{color:var(--muted); font-size:12px}
    .tools{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    details{margin-top:10px}
    details summary{cursor:pointer; color:#d8d9f0}
    .note{font-size:12px; color:#a5a6c8}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">ğŸ‘— Spinta â†’ Deriniai</div>
      <div class="pill">Spalvos â€¢ Å¡viesumo kontrastas â€¢ siluetas â€¢ akcentai â€¢ stiliaus bazÄ—</div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h2>1) PridÄ—k rÅ«bÄ…</h2>
        <div class="row">
          <div>
            <label>Nuotrauka (PNG/JPG)</label>
            <input id="file" type="file" accept="image/*" />
            <div class="note">PaletÄ— skaiÄiuojama centre (60%). Ignoruojamas labai Å¡viesus/pilkÅ¡vas fonas.</div>
          </div>
          <div>
            <label>Kategorija</label>
            <select id="cat">
              <option>VirÅ¡us</option><option>ApaÄia</option><option>SuknelÄ—</option>
              <option>VirÅ¡utiniai</option><option>Batai</option><option>Aksesuaras</option>
            </select>
          </div>
          <div>
            <label>Stilius (bazei)</label>
            <select id="style">
              <option value="basic">Basic</option>
              <option value="smart">Smart</option>
              <option value="bold">Bold</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div>
            <label>Siluetas</label>
            <select id="fit">
              <option value="regular">Reguliarus</option>
              <option value="slim">Siauras</option>
              <option value="wide">Platus/oversize</option>
            </select>
          </div>
          <div>
            <label>Neutrali bazÄ—?</label>
            <select id="neutral"><option value="no">Ne</option><option value="yes">Taip</option></select>
          </div>
          <div>
            <label>Akcentas?</label>
            <select id="accent"><option value="no">Ne</option><option value="yes">Taip</option></select>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div>
            <label>Pastaba (nebÅ«tina)</label>
            <input id="note" type="text" placeholder="pvz., raÅ¡tuota suknelÄ—" />
          </div>
          <div>
            <label>Å½yma</label>
            <input id="tag" type="text" placeholder="#darbas #laisvalaikis" />
          </div>
          <div style="flex:0 0 auto; align-self:end">
            <button class="primary" id="addBtn">â• Ä®kelti</button>
          </div>
        </div>

        <div class="tools">
          <button class="ghost" id="exportBtn">ğŸ’¾ Eksportuoti spintÄ… (JSON)</button>
          <label class="chip" style="cursor:pointer">
            ğŸ“¥ Importuoti
            <input id="importFile" type="file" accept="application/json" style="display:none">
          </label>
          <button class="ghost" id="clearWardrobe">ğŸ—‘ï¸ IÅ¡valyti spintÄ…</button>
        </div>

        <details>
          <summary>ğŸ“˜ Trumpas principÅ³ gidas</summary>
          <ul class="note">
            <li>Spalvos: analogas arba komplementaras; proporcija 60/30/10.</li>
            <li>Å viesumas: bent vienas Å¡viesus + vienas tamsesnis elementas.</li>
            <li>Siluetas: platus virÅ¡us â†’ siaura apaÄia ir atvirkÅ¡Äiai.</li>
            <li>Stiliaus bazÄ—: vienas pagrindinis stilius derinyje.</li>
            <li>Akcentai: 1 (saugiai) arba 2 (drÄ…siau, kai â€DrÄ…saâ€œ &gt; 70).</li>
          </ul>
        </details>
      </section>

      <section class="card">
        <h2>2) DeriniÅ³ nustatymai</h2>
        <div class="row">
          <div>
            <label>DeriniÅ³ kiekis</label>
            <input id="count" type="number" min="1" max="20" value="6" />
          </div>
          <div>
            <label>DrÄ…sos lygis</label>
            <input id="boldness" type="range" min="0" max="100" value="35" />
            <div class="muted">0 â€“ saugiai (1 akcentas), 100 â€“ drÄ…siai (2+ akcentai)</div>
          </div>
          <div>
            <label>Stiliaus bazÄ—</label>
            <select id="context">
              <option value="any">Bet koks</option>
              <option value="basic">Basic (laisvalaikis)</option>
              <option value="smart">Smart (darbui)</option>
              <option value="bold">Bold (drÄ…siau)</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="primary" id="genBtn">âœ¨ Generuoti derinius</button>
          <button class="ghost" id="clearOutfits">ğŸ—‘ï¸ IÅ¡valyti derinius</button>
          <div class="pill">Reikia: (VirÅ¡us+ApaÄia+Batai) arba (SuknelÄ—+Batai)</div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:18px">
      <h2>3) Tavo spinta</h2>
      <div id="wardrobe" class="wardrobe"></div>
      <div class="muted" id="emptyMsg">Dar nÄ—ra Ä¯keltÅ³ rÅ«bÅ³.</div>
    </section>

    <section class="card" style="margin-top:18px">
      <h2>4) Sugeneruoti deriniai</h2>
      <div id="outfits" class="outfits"></div>
    </section>
  </main>

<script>
const $ = (s)=>document.querySelector(s);
let wardrobe = [];
const KEY="wardrobe_principles_v1";

// ---------- Storage ----------
function saveWardrobe(){ try{ localStorage.setItem(KEY, JSON.stringify(wardrobe)); }catch(e){} }
function loadWardrobe(){ try{ wardrobe = JSON.parse(localStorage.getItem(KEY) || "[]"); }catch(e){ wardrobe=[]; } }

// ---------- Colors & palette ----------
function rgbToHsl(r,g,b){r/=255;g/=255;b/=255;const max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max===min){h=s=0;}else{const d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return [h*360,s,l]}
function hex(c){return '#'+c.map(v=>('0'+v.toString(16)).slice(-2)).join('')}
function kmeans(pixels, k=6, iters=10){
  const centers = []; const used = new Set();
  while(centers.length < k && centers.length < pixels.length){
    const idx = Math.floor(Math.random()*pixels.length);
    if(!used.has(idx)){ used.add(idx); centers.push(pixels[idx].slice()); }
  }
  for(let t=0;t<iters;t++){
    const groups = Array.from({length:k}, ()=>({sum:[0,0,0], n:0}));
    for(const p of pixels){
      let best=0, bd=1e9;
      for(let i=0;i<centers.length;i++){
        const c=centers[i]; const d=(p[0]-c[0])**2+(p[1]-c[1])**2+(p[2]-c[2])**2;
        if(d<bd){bd=d; best=i;}
      }
      groups[best].sum[0]+=p[0]; groups[best].sum[1]+=p[1]; groups[best].sum[2]+=p[2]; groups[best].n++;
    }
    for(let i=0;i<centers.length;i++){
      if(groups[i].n>0){
        centers[i][0]=groups[i].sum[0]/groups[i].n;
        centers[i][1]=groups[i].sum[1]/groups[i].n;
        centers[i][2]=groups[i].sum[2]/groups[i].n;
      }
    }
  }
  const counts = Array(centers.length).fill(0);
  for(const p of pixels){
    let best=0, bd=1e9;
    for(let i=0;i<centers.length;i++){
      const c=centers[i]; const d=(p[0]-c[0])**2+(p[1]-c[1])**2+(p[2]-c[2])**2;
      if(d<bd){bd=d; best=i;}
    }
    counts[best]++;
  }
  return centers.map((c,i)=>({rgb:c, count:counts[i]}));
}

function extractPalette(img, want=3){
  const cvs=document.createElement('canvas'); const ctx=cvs.getContext('2d');
  const w=img.naturalWidth, h=img.naturalHeight;
  const S=280; const r=Math.min(1, S/Math.max(w,h));
  cvs.width=w*r; cvs.height=h*r; ctx.drawImage(img,0,0,cvs.width,cvs.height);
  const cx=Math.floor(cvs.width*0.2), cy=Math.floor(cvs.height*0.2);
  const cw=Math.floor(cvs.width*0.6), ch=Math.floor(cvs.height*0.6);
  const data=ctx.getImageData(cx,cy,cw,ch).data;
  const pix=[];
  for(let i=0;i<data.length;i+=4*3){
    const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
    if(a<220) continue;
    const [H,Sv,L]=rgbToHsl(r,g,b);
    const nearGray = Math.abs(r-g)<12 && Math.abs(g-b)<12;
    if(nearGray && (r+g+b)/3 > 200) continue;   // baltas/pilkÅ¡vas fonas
    if(Sv < 0.12 && L > 0.78) continue;         // labai iÅ¡blukÄ™s fonas
    if(L > 0.97) continue;                      // beveik balta
    pix.push([r,g,b]);
  }
  if(!pix.length){
    const rgb=[100,100,100]; return [{rgb, hex:hex(rgb), hsl:rgbToHsl(...rgb), count:1}];
  }
  const clusters=kmeans(pix, 6, 10).map(c=>{
    const rgb=c.rgb.map(x=>Math.round(x));
    return {rgb, hex:hex(rgb), hsl:rgbToHsl(rgb[0],rgb[1],rgb[2]), count:c.count};
  });
  clusters.forEach(c=>{ c.score=c.count*(0.9 + c.hsl[1]*0.6 + (1-c.hsl[2])*0.2); });
  clusters.sort((a,b)=>b.score-a.score);
  const res=[];
  for(const c of clusters){
    const distinct = res.every(r=> Math.min(Math.abs(r.hsl[0]-c.hsl[0]), 360-Math.abs(r.hsl[0]-c.hsl[0])) > 18
                                   && Math.abs(r.hsl[2]-c.hsl[2]) > 0.06 );
    if(distinct) res.push(c);
    if(res.length>=want) break;
  }
  if(!res.length) res.push(clusters[0]);
  return res;
}

// ---------- Data & UI ----------
function loadImage(src){ return new Promise((resolve,reject)=>{ const img=new Image(); img.onload=()=>resolve(img); img.onerror=reject; img.src=src; }); }
function addItem({src,cat,style,fit,neutral,accent,note,tag}){
  loadImage(src).then(img=>{
    const palette=extractPalette(img,3);
    const item={id:crypto.randomUUID(), src, cat, style, fit, neutral, accent, note, tag, palette, color:palette[0]};
    wardrobe.push(item); saveWardrobe(); renderWardrobe();
  });
}
function renderWardrobe(){
  const list=$('#wardrobe'); list.innerHTML='';
  if(!wardrobe.length){ $('#emptyMsg').style.display='block'; } else { $('#emptyMsg').style.display='none'; }
  wardrobe.forEach(it=>{
    const card=document.createElement('div'); card.className='item';
    const top=document.createElement('div'); top.className='imgwrap'; const img=new Image(); img.src=it.src; top.appendChild(img);
    const meta=document.createElement('div'); meta.className='meta';
    const left=document.createElement('div'); left.innerHTML=`<div class="chip">${it.cat}</div>`;
    const right=document.createElement('div'); right.className='swatches';
    it.palette.slice(0,3).forEach(p=>{ const d=document.createElement('div'); d.className='sw'; d.style.background=p.hex; right.appendChild(d); });
    const chips=document.createElement('div'); chips.className='tags';
    chips.innerHTML = `<span class="tag">${it.style}</span><span class="tag">${it.fit}</span>` + (it.neutral==='yes'?`<span class="tag">neutral</span>`:'') + (it.accent==='yes'?`<span class="tag">accent</span>`:'');
    meta.appendChild(left); meta.appendChild(right);
    card.appendChild(top); card.appendChild(meta); card.appendChild(chips);
    list.appendChild(card);
  })
}

// ---------- Scoring with principles ----------
function hueDist(h1,h2){let d=Math.abs(h1-h2); return Math.min(d,360-d)}
function pairHarmony(huesA,huesB){
  let best=0;
  for(const ha of huesA) for(const hb of huesB){
    const d=hueDist(ha,hb);
    const analog= Math.exp(-Math.pow(d-30,2)/ (2*20*20));
    const comp  = Math.exp(-Math.pow(d-180,2)/(2*25*25));
    best = Math.max(best, analog*0.9 + comp*1.1);
  }
  return best;
}
function lightnessContrast(a,b){ return Math.abs(a - b); }

function scoreCombo(items, boldness, context){
  let score=0;

  // SpalvÅ³ harmonija (analogai/komplementarai) pagal paletes
  const palHues = items.map(it=> it.palette.slice(0,2).map(p=>p.hsl[0]));
  for(let i=0;i<palHues.length;i++) for(let j=i+1;j<palHues.length;j++){
    score += pairHarmony(palHues[i], palHues[j]);
  }

  // Å viesumo kontrastas tarp virÅ¡aus ir apaÄios
  const top = items.find(i=>i.cat==='VirÅ¡us') || items.find(i=>i.cat==='SuknelÄ—');
  const bottom = items.find(i=>i.cat==='ApaÄia');
  if(top && bottom){
    const L1 = top.palette[0].hsl[2], L2 = bottom.palette[0].hsl[2];
    score += lightnessContrast(L1,L2)*1.2;
  }

  // Silueto balansas
  const fitScore = (a,b)=> (a==='wide'&&b==='slim')||(a==='slim'&&b==='wide') ? 1.2 : (a==='regular'||b==='regular'?0.4:0);
  if(top && bottom) score += fitScore(top.fit, bottom.fit);

  // Stiliaus bazÄ— (vieningumas + kontekstas)
  const styles = items.map(i=>i.style);
  const baseCounts = {basic:0, smart:0, bold:0}; styles.forEach(s=>baseCounts[s]++);
  const dominantStyle = Object.entries(baseCounts).sort((a,b)=>b[1]-a[1])[0][0];
  score += 0.2; // uÅ¾ nuoseklumÄ…
  if(context!=='any') score += (dominantStyle===context) ? 0.8 : -0.5;

  // AkcentÅ³ kontrolÄ— pagal â€DrÄ…sÄ…â€œ
  const accentCount = items.filter(i=>i.accent==='yes' || i.style==='bold').length;
  const maxAccents = boldness>70 ? 2 : 1;
  if(accentCount>maxAccents) score -= (accentCount-maxAccents)*0.8;
  else score += accentCount*0.3;

  // Neutralios bazÄ—s premija, jei yra akcentÅ³
  const neutralCount = items.filter(i=>i.neutral==='yes').length;
  if(accentCount>=1) score += Math.min(neutralCount,2)*0.25;

  return score;
}

// ---------- Generate outfits ----------
function rp(arr){ return arr.length? arr[Math.floor(Math.random()*arr.length)] : null }
function generateOutfits(n,boldness, context){
  const tops=wardrobe.filter(i=>i.cat==='VirÅ¡us');
  const bottoms=wardrobe.filter(i=>i.cat==='ApaÄia');
  const dresses=wardrobe.filter(i=>i.cat==='SuknelÄ—');
  const outers=wardrobe.filter(i=>i.cat==='VirÅ¡utiniai');
  const shoes=wardrobe.filter(i=>i.cat==='Batai');
  const result=[]; const tries=2500;
  for(let k=0;k<tries && result.length<n; k++){
    const useDress = dresses.length && Math.random()<0.35;
    let combo=[];
    if(useDress){
      const d=rp(dresses); const sh=rp(shoes); if(!d||!sh) continue; combo=[d,sh]; const o = Math.random()<0.5?rp(outers):null; if(o) combo.push(o);
    }else{
      const t=rp(tops), b=rp(bottoms), sh=rp(shoes); if(!t||!b||!sh) continue; combo=[t,b,sh]; const o=Math.random()<0.4?rp(outers):null; if(o) combo.push(o);
    }
    const sc=scoreCombo(combo,boldness, context);
    result.push({items:combo, score:sc});
    result.sort((a,b)=>b.score-a.score);
    if(result.length>n) result.pop();
  }
  return result;
}

// ---------- Drawing ----------
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  if (w<2*r) r=w/2; if (h<2*r) r=h/2; ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); if(fill) ctx.fill(); if(stroke) ctx.stroke();
}
function loadImage(src){ return new Promise((resolve,reject)=>{ const img=new Image(); img.onload=()=>resolve(img); img.onerror=reject; img.src=src; }); }
async function renderOutfitToCanvas(outfit, canvas){
  const ctx=canvas.getContext('2d'); const width=canvas.width=600, height=canvas.height=800;
  const grad=ctx.createLinearGradient(0,0,0,height); grad.addColorStop(0,'#0f0f16'); grad.addColorStop(1,'#0b0b12'); ctx.fillStyle=grad; ctx.fillRect(0,0,width,height);
  ctx.fillStyle='rgba(255,255,255,.08)'; roundRect(ctx,16,16,170,28,12,true,false);
  ctx.fillStyle='#eaeaf2'; ctx.font='12px Inter, system-ui'; ctx.fillText('Outfit', 26, 34);
  const slots=outfit.items.length; const pad=22; const areaH=height-80; const boxH=Math.min(260, (areaH - pad*(slots-1))/slots);
  let y=60; const imgs = await Promise.all(outfit.items.map(it=>loadImage(it.src)));
  for(let idx=0; idx<imgs.length; idx++){
    const it = outfit.items[idx]; const img = imgs[idx];
    const ratio = Math.min((width-2*pad)/img.naturalWidth, boxH/img.naturalHeight);
    const w=img.naturalWidth*ratio, h=img.naturalHeight*ratio; const x=(width-w)/2;
    ctx.fillStyle='rgba(255,255,255,.04)'; roundRect(ctx, pad-6, y-6, width-2*(pad-6), h+12, 14, true, false);
    ctx.drawImage(img, x, y, w, h);
    // paletÄ—s taÅ¡kai
    let dx = width-20 - Math.min(3,it.palette.length)*16;
    it.palette.slice(0,3).forEach(p=>{ ctx.fillStyle=p.hex; roundRect(ctx, dx, y-6, 14, 14, 4, true, false); dx += 16; });
    // Å¾ymÄ—s
    ctx.fillStyle='rgba(255,255,255,.35)'; ctx.font='10px Inter, system-ui';
    ctx.fillText(`${it.cat} â€¢ ${it.style} â€¢ ${it.fit}${it.accent==='yes'?' â€¢ accent':''}${it.neutral==='yes'?' â€¢ neutral':''}`, 24, y+h+10);
    y += boxH + pad;
  }
}

function renderOutfits(list){
  const root=$('#outfits'); root.innerHTML='';
  list.forEach((o,i)=>{
    const card=document.createElement('div'); card.className='outfit';
    const cvswrap=document.createElement('div'); cvswrap.className='canvaswrap';
    const canvas=document.createElement('canvas');
    const loading=document.createElement('div'); loading.className='loading'; loading.textContent='PieÅ¡iama...';
    cvswrap.appendChild(canvas); cvswrap.appendChild(loading);
    const row=document.createElement('div'); row.className='row';
    const info=document.createElement('div'); info.innerHTML=`<div class="muted">Score: ${o.score.toFixed(2)}</div>`;
    const dl=document.createElement('a'); dl.textContent='â¬‡ï¸ AtsisiÅ³sti PNG'; dl.download=`outfit_${i+1}.png`; dl.href='#'; dl.className='chip'; dl.style.textAlign='center'; dl.style.textDecoration='none';
    row.appendChild(info); row.appendChild(dl);
    card.appendChild(cvswrap); card.appendChild(row);
    document.getElementById('outfits').appendChild(card);
    renderOutfitToCanvas(o, canvas).then(()=>{ loading.remove(); dl.href = canvas.toDataURL('image/png'); });
  })
}

// ---------- Events ----------
document.getElementById('addBtn').addEventListener('click', async ()=>{
  const f=document.getElementById('file').files[0]; if(!f){alert('Pasirink nuotraukÄ…'); return}
  const src=await fileToDataURL(f);
  const cat=$('#cat').value, style=$('#style').value, fit=$('#fit').value;
  const neutral=$('#neutral').value, accent=$('#accent').value;
  const note=$('#note').value, tag=$('#tag').value;
  addItem({src,cat,style,fit,neutral,accent,note,tag});
  $('#file').value=''; $('#note').value=''; $('#tag').value='';
})
document.getElementById('genBtn').addEventListener('click', ()=>{
  const n=parseInt($('#count').value)||6; const b=parseInt($('#boldness').value)||35; const ctx=$('#context').value;
  const outfits=generateOutfits(n,b,ctx); renderOutfits(outfits);
})
document.getElementById('clearOutfits').addEventListener('click', ()=>{$('#outfits').innerHTML='';})
document.getElementById('exportBtn').addEventListener('click', exportWardrobe);
document.getElementById('importFile').addEventListener('change', (e)=>{ const f=e.target.files[0]; if(f) importWardrobe(f); })
document.getElementById('clearWardrobe').addEventListener('click', ()=>{ if(confirm("IÅ¡valyti visÄ… spintÄ…?")){ wardrobe=[]; saveWardrobe(); renderWardrobe(); } });

function fileToDataURL(file){return new Promise((res,rej)=>{const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file)})}

// ---------- Export / Import ----------
function exportWardrobe(){
  const blob = new Blob([JSON.stringify(wardrobe, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href=url; a.download="spinta.json"; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
}
async function importWardrobe(file){
  const txt = await file.text();
  try{
    const arr = JSON.parse(txt);
    if(Array.isArray(arr)){ wardrobe = arr; saveWardrobe(); renderWardrobe(); alert("Spinta Ä¯kelta âœ”ï¸"); }
    else alert("Netinkamas failas");
  }catch(e){ alert("Nepavyko perskaityti failo"); }
}

// Init
loadWardrobe(); renderWardrobe();
</script>
</body>
</html>
